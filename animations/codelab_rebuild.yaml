name: Add animation effects to your Flutter app
steps:
  - name: step_01
    steps:
      - name: Remove step_01
        rmdir: step_01
      - name: Create project
        flutter: create --empty quiz
      - name: Strip DEVELOPMENT_TEAM
        strip-lines-containing: DEVELOPMENT_TEAM =
        path: quiz/ios/Runner.xcodeproj/project.pbxproj
      - name: Remove README
        rm: quiz/README.md
      - name: Replace pubspec.yaml
        path: quiz/pubspec.yaml
        replace-contents: |
          name: quiz
          description: A quiz app for demonstrating animation effects in Flutter
          publish_to: "none"
          version: 1.0.0

          environment:
            sdk: ^3.7.0-0

          dependencies:
            animations: ^2.0.0
            flutter:
              sdk: flutter

          dev_dependencies:
            flutter_test:
              sdk: flutter
            flutter_lints: ^4.0.0


          flutter:
            uses-material-design: true
      - name: Replace analysis_options.yaml
        path: quiz/analysis_options.yaml
        replace-contents: |
          include: ../../analysis_options.yaml

          analyzer:
            errors:
              unused_field: ignore

          linter:
            rules:
              annotate_overrides: false
              prefer_const_constructors: false
              prefer_const_constructors_in_immutables: false
              prefer_const_declarations: false
              prefer_const_literals_to_create_immutables: false
      - name: Add lib/home_screen.dart
        path: quiz/lib/home_screen.dart
        replace-contents: |
          import 'package:flutter/material.dart';
          import 'question_screen.dart';

          class HomeScreen extends StatelessWidget {
            const HomeScreen({super.key});

            @override
            Widget build(BuildContext context) {
              return Scaffold(
                body: Center(
                  child: Column(
                    mainAxisSize: MainAxisSize.min,
                    children: [
                      Text('✏️', style: Theme.of(context).textTheme.displayLarge),
                      Text(
                        'Flutter Quiz',
                        style: Theme.of(context).textTheme.displayLarge!.copyWith(
                          fontWeight: FontWeight.w700,
                          color: Theme.of(context).colorScheme.onPrimaryFixedVariant,
                        ),
                      ),
                      ElevatedButton(
                        onPressed: () {
                          // Show the question screen to start the game
                          Navigator.push(
                            context,
                            MaterialPageRoute(
                              builder: (context) {
                                return QuestionScreen();
                              },
                            ),
                          );
                        },
                        child: Text('New Game'),
                      ),
                    ],
                  ),
                ),
              );
            }
          }
      - name: Add lib/main.dart
        path: quiz/lib/main.dart
        replace-contents: |
          import 'package:flutter/material.dart';
          
          import 'home_screen.dart';
          
          void main() {
            runApp(MainApp());
          }
          
          class MainApp extends StatelessWidget {
            const MainApp({super.key});
          
            @override
            Widget build(BuildContext context) {
              return MaterialApp(
                debugShowCheckedModeBanner: false,
                theme: ThemeData(
                  colorScheme: ColorScheme.fromSeed(seedColor: Colors.blue),
                ),
                home: HomeScreen(),
              );
            }
          }
      - name: Add lib/model.dart
        path: quiz/lib/model.dart
        replace-contents: |
          import 'dart:math' as math;

          class Question {
            final String question;
            final List<String> possibleAnswers;
            final int correctAnswer;
            Question(this.question, this.possibleAnswers, this.correctAnswer);
          }

          class QuestionBank {
            final List<Question> _questions = _createQuestions();

            bool get hasNextQuestion => _questions.isNotEmpty;
            int get remainingQuestions => _questions.length;

            Question? getRandomQuestion() {
              if (_questions.isEmpty) {
                return null;
              }

              var i = math.Random().nextInt(_questions.length);
              var question = _questions[i];

              _questions.removeAt(i);
              return question;
            }
          }

          List<Question> _createQuestions() {
            return [
              Question(
                'What class used to create custom explicit animations in Flutter?',
                ['AnimationController', 'AnimatedWidget', 'AnimatedBuilder', 'Tween'],
                0,
              ),
              Question(
                'Which widget is used to rebuild its child whenever an animation changes?',
                [
                  'AnimatedContainer',
                  'AnimatedBuilder',
                  'AnimatedSwitcher',
                  'AnimatedOpacity',
                ],
                1,
              ),
              Question(
                'What class is used to define the start and end values for an animation?',
                ['Tween', 'Curve', 'AnimationController', 'AnimatedWidget'],
                0,
              ),
            ];
          }
      - name: Add lib/view_model.dart
        path: quiz/lib/view_model.dart
        replace-contents: |
          import 'package:flutter/cupertino.dart';
          import 'model.dart';
          
          class QuizViewModel extends ChangeNotifier {
            final QuestionBank _questionBank = QuestionBank();
            final VoidCallback onGameOver;
            late final int totalQuestions;
            Question? currentQuestion;
            int answeredQuestionCount = 0;
            int score = 0;
            bool didAnswerQuestion = false;
            bool get hasNextQuestion => answeredQuestionCount < totalQuestions;
          
            QuizViewModel({required this.onGameOver}) {
              totalQuestions = _questionBank.remainingQuestions;
              getNextQuestion();
            }
          
            void getNextQuestion() {
              if (_questionBank.hasNextQuestion) {
                currentQuestion = _questionBank.getRandomQuestion();
                answeredQuestionCount++;
              }
          
              didAnswerQuestion = false;
          
              notifyListeners();
            }
          
            void checkAnswer(int selectedIndex) {
              if (!didAnswerQuestion && currentQuestion?.correctAnswer == selectedIndex) {
                score++;
              }
          
              didAnswerQuestion = true;
          
              if (!_questionBank.hasNextQuestion) {
                onGameOver();
              }
          
              notifyListeners();
            }
          }
      - name: Add lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        replace-contents: |
          import 'package:flutter/material.dart';
          import 'view_model.dart';

          class QuestionScreen extends StatefulWidget {
            const QuestionScreen({super.key});

            @override
            State<QuestionScreen> createState() => _QuestionScreenState();
          }

          class _QuestionScreenState extends State<QuestionScreen> {
            late final QuizViewModel viewModel = QuizViewModel(
              onGameOver: _handleGameOver,
            );

            @override
            Widget build(BuildContext context) {
              return ListenableBuilder(
                listenable: viewModel,
                builder: (context, child) {
                  return Scaffold(
                    appBar: AppBar(
                      actions: [
                        TextButton(
                          onPressed:
                              viewModel.hasNextQuestion && viewModel.didAnswerQuestion
                                  ? () {
                                    viewModel.getNextQuestion();
                                  }
                                  : null,
                          child: const Text('Next'),
                        ),
                      ],
                    ),
                    body: Center(
                      child: Column(
                        children: [
                          QuestionCard(question: viewModel.currentQuestion?.question),
                          Spacer(),
                          AnswerCards(
                            onTapped: (index) {
                              viewModel.checkAnswer(index);
                            },
                            answers: viewModel.currentQuestion?.possibleAnswers ?? [],
                            correctAnswer:
                                viewModel.didAnswerQuestion
                                    ? viewModel.currentQuestion?.correctAnswer
                                    : null,
                          ),
                          StatusBar(viewModel: viewModel),
                        ],
                      ),
                    ),
                  );
                },
              );
            }

            void _handleGameOver() {
              showDialog(
                barrierDismissible: false,
                context: context,
                builder: (context) {
                  return AlertDialog(
                    title: Text('Game Over!'),
                    content: Text('Score: ${viewModel.score}'),
                    actions: [
                      TextButton(
                        onPressed: () {
                          Navigator.popUntil(context, (route) => route.isFirst);
                        },
                        child: Text('OK'),
                      ),
                    ],
                  );
                },
              );
            }
          }

          class QuestionCard extends StatelessWidget {
            final String? question;

            const QuestionCard({required this.question, super.key});

            @override
            Widget build(BuildContext context) {
              return Card(
                elevation: 4,
                child: Padding(
                  padding: EdgeInsets.all(16.0),
                  child: Text(
                    question ?? '',
                    style: Theme.of(context).textTheme.displaySmall,
                  ),
                ),
              );
            }
          }

          class AnswerCards extends StatelessWidget {
            final List<String> answers;
            final ValueChanged<int> onTapped;
            final int? correctAnswer;

            const AnswerCards({
              required this.answers,
              required this.onTapped,
              required this.correctAnswer,
              super.key,
            });

            @override
            Widget build(BuildContext context) {
              return GridView.count(
                shrinkWrap: true,
                crossAxisCount: 2,
                childAspectRatio: 5 / 2,
                children: List.generate(answers.length, (index) {
                  var color = Theme.of(context).colorScheme.primaryContainer;
                  if (correctAnswer == index) {
                    color = Theme.of(context).colorScheme.tertiaryContainer;
                  }
                  return Card.filled(
                    key: ValueKey(answers[index]),
                    color: color,
                    elevation: 2,
                    margin: EdgeInsets.all(8),
                    clipBehavior: Clip.hardEdge,
                    child: InkWell(
                      onTap: () => onTapped(index),
                      child: Padding(
                        padding: EdgeInsets.all(16.0),
                        child: Center(
                          child: Text(
                            answers.length > index ? answers[index] : '',
                            style: Theme.of(context).textTheme.titleMedium,
                            overflow: TextOverflow.clip,
                          ),
                        ),
                      ),
                    ),
                  );
                }),
              );
            }
          }

          class StatusBar extends StatelessWidget {
            final QuizViewModel viewModel;

            const StatusBar({required this.viewModel, super.key});

            @override
            Widget build(BuildContext context) {
              return Card(
                elevation: 4,
                child: Padding(
                  padding: EdgeInsets.all(8.0),
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.spaceAround,
                    children: [
                      Text(
                        'Question ${viewModel.answeredQuestionCount} / ${viewModel.totalQuestions}',
                        style: Theme.of(context).textTheme.titleLarge,
                      ),
                      Text(
                        'Score: ${viewModel.score}',
                        style: Theme.of(context).textTheme.titleLarge,
                      ),
                    ],
                  ),
                ),
              );
            }
          }
      - name: Fetch dependencies
        path: quiz
        dart: pub get
      - name: Copy step_01
        copydir:
          from: quiz
          to: step_01

  - name: step_02_a
    steps:
      - name: Remove step_02_a
        rmdir: step_02_a
      - name: Add lib/scoreboard.dart
        path: quiz/lib/scoreboard.dart
        replace-contents: |
          import 'package:flutter/material.dart';

          class Scoreboard extends StatelessWidget {
            final int score;
            final int totalQuestions;

            const Scoreboard({
              super.key,
              required this.score,
              required this.totalQuestions,
            });

            @override
            Widget build(BuildContext context) {
              return Padding(
                padding: const EdgeInsets.all(8.0),
                child: Row(
                  mainAxisAlignment: MainAxisAlignment.center,
                  children: [
                    for (var i = 0; i < totalQuestions; i++)
                      Icon(
                        Icons.star,
                        size: 50,
                        color:
                            score < i + 1 ? Colors.grey.shade400 : Colors.yellow.shade700,
                      ),
                  ],
                ),
              );
            }
          }
      - name: Copy step_02_a
        copydir:
          from: quiz
          to: step_02_a

  - name: step_02_b
    steps:
      - name: Remove step_02_b
        rmdir: step_02_b
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_02_b/lib/question_screen.dart
          +++ a/animations/step_02_b/lib/question_screen.dart
          @@ -1,4 +1,5 @@
           import 'package:flutter/material.dart';
          +import 'scoreboard.dart';
           import 'view_model.dart';
           
           class QuestionScreen extends StatefulWidget {
          @@ -160,13 +161,9 @@ class StatusBar extends StatelessWidget {
                   child: Row(
                     mainAxisAlignment: MainAxisAlignment.spaceAround,
                     children: [
          -            Text(
          -              'Question ${viewModel.answeredQuestionCount} / ${viewModel.totalQuestions}',
          -              style: Theme.of(context).textTheme.titleLarge,
          -            ),
          -            Text(
          -              'Score: ${viewModel.score}',
          -              style: Theme.of(context).textTheme.titleLarge,
          +            Scoreboard(
          +              score: viewModel.score,
          +              totalQuestions: viewModel.totalQuestions,
                       ),
                     ],
                   ),
      - name: Copy step_02_b
        copydir:
          from: quiz
          to: step_02_b

  - name: step_02_c
    steps:
      - name: Remove step_02_c
        rmdir: step_02_c
      - name: Patch lib/scoreboard.dart
        path: quiz/lib/scoreboard.dart
        patch-u: |
          --- b/animations/step_02_c/lib/scoreboard.dart
          +++ a/animations/step_02_c/lib/scoreboard.dart
          @@ -18,14 +18,31 @@ class Scoreboard extends StatelessWidget {
                   mainAxisAlignment: MainAxisAlignment.center,
                   children: [
                     for (var i = 0; i < totalQuestions; i++)
          -            Icon(
          -              Icons.star,
          -              size: 50,
          -              color:
          -                  score < i + 1 ? Colors.grey.shade400 : Colors.yellow.shade700,
          -            ),
          +            AnimatedStar(isActive: score > i),
                   ],
                 ),
               );
             }
           }
          +
          +class AnimatedStar extends StatelessWidget {
          +  final bool isActive;
          +  final Duration _duration = const Duration(milliseconds: 1000);
          +  final Color _deactivatedColor = Colors.grey.shade400;
          +  final Color _activatedColor = Colors.yellow.shade700;
          +
          +  AnimatedStar({super.key, required this.isActive});
          +
          +  @override
          +  Widget build(BuildContext context) {
          +    return AnimatedScale(
          +      scale: isActive ? 1.0 : 0.5,
          +      duration: _duration,
          +      child: Icon(
          +        Icons.star,
          +        size: 50,
          +        color: isActive ? _activatedColor : _deactivatedColor,
          +      ),
          +    );
          +  }
          +}
      - name: Copy step_02_c
        copydir:
          from: quiz
          to: step_02_c

  - name: step_02_d
    steps:
      - name: Remove step_02_d
        rmdir: step_02_d
      - name: Patch lib/scoreboard.dart
        path: quiz/lib/scoreboard.dart
        patch-u: |
          --- b/animations/step_02_d/lib/scoreboard.dart
          +++ a/animations/step_02_d/lib/scoreboard.dart
          @@ -38,10 +38,15 @@ class AnimatedStar extends StatelessWidget {
               return AnimatedScale(
                 scale: isActive ? 1.0 : 0.5,
                 duration: _duration,
          -      child: Icon(
          -        Icons.star,
          -        size: 50,
          -        color: isActive ? _activatedColor : _deactivatedColor,
          +      child: TweenAnimationBuilder(
          +        duration: _duration,
          +        tween: ColorTween(
          +          begin: _deactivatedColor,
          +          end: isActive ? _activatedColor : _deactivatedColor,
          +        ),
          +        builder: (context, value, child) {
          +          return Icon(Icons.star, size: 50, color: value);
          +        },
                 ),
               );
             }
      - name: Copy step_02_d
        copydir:
          from: quiz
          to: step_02_d

  - name: step_02_e
    steps:
      - name: Remove step_02_e
        rmdir: step_02_e
      - name: Patch lib/scoreboard.dart
        path: quiz/lib/scoreboard.dart
        patch-u: |
          --- b/animations/step_02_e/lib/scoreboard.dart
          +++ a/animations/step_02_e/lib/scoreboard.dart
          @@ -30,6 +30,7 @@ class AnimatedStar extends StatelessWidget {
             final Duration _duration = const Duration(milliseconds: 1000);
             final Color _deactivatedColor = Colors.grey.shade400;
             final Color _activatedColor = Colors.yellow.shade700;
          +  final Curve _curve = Curves.elasticOut;
           
             AnimatedStar({super.key, required this.isActive});
           
          @@ -37,8 +38,10 @@ class AnimatedStar extends StatelessWidget {
             Widget build(BuildContext context) {
               return AnimatedScale(
                 scale: isActive ? 1.0 : 0.5,
          +      curve: _curve,
                 duration: _duration,
                 child: TweenAnimationBuilder(
          +        curve: _curve,
                   duration: _duration,
                   tween: ColorTween(
                     begin: _deactivatedColor,
      - name: Copy step_02_e
        copydir:
          from: quiz
          to: step_02_e

  - name: step_03_a
    steps:
      - name: Remove step_03_a
        rmdir: step_03_a
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_03_a/lib/question_screen.dart
          +++ a/animations/step_03_a/lib/question_screen.dart
          @@ -86,13 +86,17 @@ class QuestionCard extends StatelessWidget {
           
             @override
             Widget build(BuildContext context) {
          -    return Card(
          -      elevation: 4,
          -      child: Padding(
          -        padding: EdgeInsets.all(16.0),
          -        child: Text(
          -          question ?? '',
          -          style: Theme.of(context).textTheme.displaySmall,
          +    return AnimatedSwitcher(
          +      duration: const Duration(milliseconds: 300),
          +      child: Card(
          +        key: ValueKey(question),
          +        elevation: 4,
          +        child: Padding(
          +          padding: const EdgeInsets.all(16.0),
          +          child: Text(
          +            question ?? '',
          +            style: Theme.of(context).textTheme.displaySmall,
          +          ),
                   ),
                 ),
               );
      - name: Copy step_03_a
        copydir:
          from: quiz
          to: step_03_a

  - name: step_03_b
    steps:
      - name: Remove step_03_b
        rmdir: step_03_b
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_03_b/lib/question_screen.dart
          +++ a/animations/step_03_b/lib/question_screen.dart
          @@ -87,6 +87,16 @@ class QuestionCard extends StatelessWidget {
             @override
             Widget build(BuildContext context) {
               return AnimatedSwitcher(
          +      transitionBuilder: (child, animation) {
          +        final curveAnimation = CurveTween(
          +          curve: Curves.easeInCubic,
          +        ).animate(animation);
          +        final offsetAnimation = Tween<Offset>(
          +          begin: Offset(-0.1, 0.0),
          +          end: Offset.zero,
          +        ).animate(curveAnimation);
          +        return SlideTransition(position: offsetAnimation, child: child);
          +      },
                 duration: const Duration(milliseconds: 300),
                 child: Card(
                   key: ValueKey(question),
      - name: Copy step_03_b
        copydir:
          from: quiz
          to: step_03_b

  - name: step_03_c
    steps:
      - name: Remove step_03_c
        rmdir: step_03_c
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_03_c/lib/question_screen.dart
          +++ a/animations/step_03_c/lib/question_screen.dart
          @@ -95,7 +95,11 @@ class QuestionCard extends StatelessWidget {
                     begin: Offset(-0.1, 0.0),
                     end: Offset.zero,
                   ).animate(curveAnimation);
          -        return SlideTransition(position: offsetAnimation, child: child);
          +        final fadeInAnimation = curveAnimation;
          +        return FadeTransition(
          +          opacity: fadeInAnimation,
          +          child: SlideTransition(position: offsetAnimation, child: child),
          +        );
                 },
                 duration: const Duration(milliseconds: 300),
                 child: Card(
      - name: Copy step_03_c
        copydir:
          from: quiz
          to: step_03_c     

  - name: step_03_d
    steps:
      - name: Remove step_03_d
        rmdir: step_03_d
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_03_d/lib/question_screen.dart
          +++ a/animations/step_03_d/lib/question_screen.dart
          @@ -87,6 +87,15 @@ class QuestionCard extends StatelessWidget {
             @override
             Widget build(BuildContext context) {
               return AnimatedSwitcher(
          +      layoutBuilder: (currentChild, previousChildren) {
          +        return Stack(
          +          alignment: Alignment.topCenter,
          +          children: <Widget>[
          +            ...previousChildren,
          +            if (currentChild != null) currentChild,
          +          ],
          +        );
          +      },
                 transitionBuilder: (child, animation) {
                   final curveAnimation = CurveTween(
                     curve: Curves.easeInCubic,
      - name: Copy step_03_d
        copydir:
          from: quiz
          to: step_03_d

  - name: step_04_a
    steps:
      - name: Remove step_04_a
        rmdir: step_04_a
      - name: Add lib/flip_effect.dart
        path: quiz/lib/flip_effect.dart
        replace-contents: |
          import 'dart:math' as math;

          import 'package:flutter/widgets.dart';

          class CardFlipEffect extends StatefulWidget {
            final Widget child;
            final Duration duration;

            const CardFlipEffect({
              super.key,
              required this.child,
              required this.duration,
            });

            @override
            State<CardFlipEffect> createState() => _CardFlipEffectState();
          }

          class _CardFlipEffectState extends State<CardFlipEffect>
              with SingleTickerProviderStateMixin {
            late final AnimationController _animationController;
            Widget? _previousChild;

            @override
            void initState() {
              super.initState();

              _animationController = AnimationController(
                vsync: this,
                duration: widget.duration,
              );

              _animationController.addListener(() {
                if (_animationController.value == 1) {
                  _animationController.reset();
                }
              });
            }

            @override
            void didUpdateWidget(covariant CardFlipEffect oldWidget) {
              super.didUpdateWidget(oldWidget);

              if (widget.child.key != oldWidget.child.key) {
                _handleChildChanged(widget.child, oldWidget.child);
              }
            }

            void _handleChildChanged(Widget newChild, Widget previousChild) {
              _previousChild = previousChild;
              _animationController.forward();
            }

            @override
            Widget build(BuildContext context) {
              return AnimatedBuilder(
                animation: _animationController,
                builder: (context, child) {
                  return Transform(
                    alignment: Alignment.center,
                    transform:
                        Matrix4.identity()..rotateX(_animationController.value * math.pi),
                    child:
                        _animationController.isAnimating
                            ? _animationController.value < 0.5
                                ? _previousChild
                                : Transform.flip(flipY: true, child: child)
                            : child,
                  );
                },
                child: widget.child,
              );
            }
          }
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_04_a/lib/question_screen.dart
          +++ a/animations/step_04_a/lib/question_screen.dart
          @@ -1,4 +1,5 @@
           import 'package:flutter/material.dart';
          +import 'flip_effect.dart';
           import 'scoreboard.dart';
           import 'view_model.dart';
           
          @@ -149,21 +150,24 @@ class AnswerCards extends StatelessWidget {
                   if (correctAnswer == index) {
                     color = Theme.of(context).colorScheme.tertiaryContainer;
                   }
          -        return Card.filled(
          -          key: ValueKey(answers[index]),
          -          color: color,
          -          elevation: 2,
          -          margin: EdgeInsets.all(8),
          -          clipBehavior: Clip.hardEdge,
          -          child: InkWell(
          -            onTap: () => onTapped(index),
          -            child: Padding(
          -              padding: EdgeInsets.all(16.0),
          -              child: Center(
          -                child: Text(
          -                  answers.length > index ? answers[index] : '',
          -                  style: Theme.of(context).textTheme.titleMedium,
          -                  overflow: TextOverflow.clip,
          +        return CardFlipEffect(
          +          duration: const Duration(milliseconds: 300),
          +          child: Card.filled(
          +            key: ValueKey(answers[index]),
          +            color: color,
          +            elevation: 2,
          +            margin: EdgeInsets.all(8),
          +            clipBehavior: Clip.hardEdge,
          +            child: InkWell(
          +              onTap: () => onTapped(index),
          +              child: Padding(
          +                padding: EdgeInsets.all(16.0),
          +                child: Center(
          +                  child: Text(
          +                    answers.length > index ? answers[index] : '',
          +                    style: Theme.of(context).textTheme.titleMedium,
          +                    overflow: TextOverflow.clip,
          +                  ),
                           ),
                         ),
                       ),
      - name: Copy step_04_a
        copydir:
          from: quiz
          to: step_04_a

  - name: step_04_b
    steps:
      - name: Remove step_04_b
        rmdir: step_04_b
      - name: Patch lib/flp_effect.dart
        path: quiz/lib/flip_effect.dart
        patch-u: |
          --- b/animations/step_04_b/lib/flip_effect.dart
          +++ a/animations/step_04_b/lib/flip_effect.dart
          @@ -5,11 +5,13 @@ import 'package:flutter/widgets.dart';
           class CardFlipEffect extends StatefulWidget {
             final Widget child;
             final Duration duration;
          +  final double delayAmount;
           
             const CardFlipEffect({
               super.key,
               required this.child,
               required this.duration,
          +    required this.delayAmount,
             });
           
             @override
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_04_b/lib/question_screen.dart
          +++ a/animations/step_04_b/lib/question_screen.dart
          @@ -151,6 +151,7 @@ class AnswerCards extends StatelessWidget {
                     color = Theme.of(context).colorScheme.tertiaryContainer;
                   }
                   return CardFlipEffect(
          +          delayAmount: index.toDouble() / 2,
                     duration: const Duration(milliseconds: 300),
                     child: Card.filled(
                       key: ValueKey(answers[index]),
      - name: Copy step_04_b
        copydir:
          from: quiz
          to: step_04_b

  - name: step_04_c
    steps:
      - name: Remove step_04_c
        rmdir: step_04_c
      - name: Patch lib/flip_effect.dart
        path: quiz/lib/flip_effect.dart
        patch-u: |
          --- b/animations/step_04_c/lib/flip_effect.dart
          +++ a/animations/step_04_c/lib/flip_effect.dart
          @@ -22,6 +22,7 @@ class _CardFlipEffectState extends State<CardFlipEffect>
               with SingleTickerProviderStateMixin {
             late final AnimationController _animationController;
             Widget? _previousChild;
          +  late final Animation<double> _animationWithDelay;
           
             @override
             void initState() {
          @@ -29,7 +30,7 @@ class _CardFlipEffectState extends State<CardFlipEffect>
           
               _animationController = AnimationController(
                 vsync: this,
          -      duration: widget.duration,
          +      duration: widget.duration * (widget.delayAmount + 1),
               );
           
               _animationController.addListener(() {
          @@ -37,6 +38,15 @@ class _CardFlipEffectState extends State<CardFlipEffect>
                   _animationController.reset();
                 }
               });
          +
          +    _animationWithDelay = TweenSequence<double>([
          +      if (widget.delayAmount > 0)
          +        TweenSequenceItem(
          +          tween: ConstantTween<double>(0.0),
          +          weight: widget.delayAmount,
          +        ),
          +      TweenSequenceItem(tween: Tween(begin: 0.0, end: 1.0), weight: 1.0),
          +    ]).animate(_animationController);
             }
           
             @override
      - name: Copy step_04_c
        copydir:
          from: quiz
          to: step_04_c

  - name: step_04_d
    steps:
      - name: Remove step_04_d
        rmdir: step_04_d
      - name: Patch lib/flip_effect.dart
        path: quiz/lib/flip_effect.dart
        patch-u: |
          --- b/animations/step_04_d/lib/flip_effect.dart
          +++ a/animations/step_04_d/lib/flip_effect.dart
          @@ -66,15 +66,15 @@ class _CardFlipEffectState extends State<CardFlipEffect>
             @override
             Widget build(BuildContext context) {
               return AnimatedBuilder(
          -      animation: _animationController,
          +      animation: _animationWithDelay,
                 builder: (context, child) {
                   return Transform(
                     alignment: Alignment.center,
                     transform:
          -              Matrix4.identity()..rotateX(_animationController.value * math.pi),
          +              Matrix4.identity()..rotateX(_animationWithDelay.value * math.pi),
                     child:
                         _animationController.isAnimating
          -                  ? _animationController.value < 0.5
          +                  ? _animationWithDelay.value < 0.5
                                 ? _previousChild
                                 : Transform.flip(flipY: true, child: child)
                             : child,
      - name: Copy step_04_d
        copydir:
          from: quiz
          to: step_04_d

  - name: step_05_a
    steps:
      - name: Remove step_05_a
        rmdir: step_05_a
      - name: Patch lib/home_screen.dart
        path: quiz/lib/home_screen.dart
        patch-u: |
          --- b/animations/step_05_a/lib/home_screen.dart
          +++ a/animations/step_05_a/lib/home_screen.dart
          @@ -24,9 +24,17 @@ class HomeScreen extends StatelessWidget {
                           // Show the question screen to start the game
                           Navigator.push(
                             context,
          -                  MaterialPageRoute(
          -                    builder: (context) {
          -                      return QuestionScreen();
          +                  PageRouteBuilder(
          +                    pageBuilder: (context, animation, secondaryAnimation) {
          +                      return const QuestionScreen();
          +                    },
          +                    transitionsBuilder: (
          +                      context,
          +                      animation,
          +                      secondaryAnimation,
          +                      child,
          +                    ) {
          +                      return FadeTransition(opacity: animation, child: child);
                               },
                             ),
                           );
      - name: Copy step_05_a
        copydir:
          from: quiz
          to: step_05_a

  - name: step_05_b
    steps:
      - name: Remove step_05_b
        rmdir: step_05_b
      - name: Patch lib/home_screen.dart
        path: quiz/lib/home_screen.dart
        patch-u: |
          --- b/animations/step_05_b/lib/home_screen.dart
          +++ a/animations/step_05_b/lib/home_screen.dart
          @@ -1,3 +1,4 @@
          +import 'package:animations/animations.dart';
           import 'package:flutter/material.dart';
           import 'question_screen.dart';
           
          @@ -34,7 +35,11 @@ class HomeScreen extends StatelessWidget {
                                 secondaryAnimation,
                                 child,
                               ) {
          -                      return FadeTransition(opacity: animation, child: child);
          +                      return FadeThroughTransition(
          +                        animation: animation,
          +                        secondaryAnimation: secondaryAnimation,
          +                        child: child,
          +                      );
                               },
                             ),
                           );
      - name: Patch lib/main.dart
        path: quiz/lib/main.dart
        patch-u: |
          --- b/animations/step_05_b/lib/main.dart
          +++ a/animations/step_05_b/lib/main.dart
          @@ -1,3 +1,4 @@
          +import 'package:animations/animations.dart';
           import 'package:flutter/material.dart';
           
           import 'home_screen.dart';
          @@ -15,6 +16,15 @@ class MainApp extends StatelessWidget {
                 debugShowCheckedModeBanner: false,
                 theme: ThemeData(
                   colorScheme: ColorScheme.fromSeed(seedColor: Colors.blue),
          +        pageTransitionsTheme: PageTransitionsTheme(
          +          builders: {
          +            TargetPlatform.android: PredictiveBackPageTransitionsBuilder(),
          +            TargetPlatform.iOS: FadeThroughPageTransitionsBuilder(),
          +            TargetPlatform.macOS: FadeThroughPageTransitionsBuilder(),
          +            TargetPlatform.windows: FadeThroughPageTransitionsBuilder(),
          +            TargetPlatform.linux: FadeThroughPageTransitionsBuilder(),
          +          },
          +        ),
                 ),
                 home: HomeScreen(),
               );
      - name: Copy step_05_b
        copydir:
          from: quiz
          to: step_05_b

  - name: step_05_c
    steps:
      - name: Remove step_05_c
        rmdir: step_05_c
      - name: Patch lib/home_screen.dart
        path: quiz/lib/home_screen.dart
        patch-u: |
          --- b/animations/step_05_c/lib/home_screen.dart
          +++ a/animations/step_05_c/lib/home_screen.dart
          @@ -1,4 +1,3 @@
          -import 'package:animations/animations.dart';
           import 'package:flutter/material.dart';
           import 'question_screen.dart';
           
          @@ -25,22 +24,10 @@ class HomeScreen extends StatelessWidget {
                           // Show the question screen to start the game
                           Navigator.push(
                             context,
          -                  PageRouteBuilder(
          -                    pageBuilder: (context, animation, secondaryAnimation) {
          +                  MaterialPageRoute(
          +                    builder: (context) {
                                 return const QuestionScreen();
                               },
          -                    transitionsBuilder: (
          -                      context,
          -                      animation,
          -                      secondaryAnimation,
          -                      child,
          -                    ) {
          -                      return FadeThroughTransition(
          -                        animation: animation,
          -                        secondaryAnimation: secondaryAnimation,
          -                        child: child,
          -                      );
          -                    },
                             ),
                           );
                         },
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_05_c/lib/question_screen.dart
          +++ a/animations/step_05_c/lib/question_screen.dart
          @@ -1,3 +1,4 @@
          +import 'package:animations/animations.dart';
           import 'package:flutter/material.dart';
           import 'flip_effect.dart';
           import 'scoreboard.dart';
          @@ -87,28 +88,15 @@ class QuestionCard extends StatelessWidget {
           
             @override
             Widget build(BuildContext context) {
          -    return AnimatedSwitcher(
          -      layoutBuilder: (currentChild, previousChildren) {
          -        return Stack(
          -          alignment: Alignment.topCenter,
          -          children: <Widget>[
          -            ...previousChildren,
          -            if (currentChild != null) currentChild,
          -          ],
          -        );
          +    return PageTransitionSwitcher(
          +      layoutBuilder: (entries) {
          +        return Stack(alignment: Alignment.topCenter, children: entries);
                 },
          -      transitionBuilder: (child, animation) {
          -        final curveAnimation = CurveTween(
          -          curve: Curves.easeInCubic,
          -        ).animate(animation);
          -        final offsetAnimation = Tween<Offset>(
          -          begin: Offset(-0.1, 0.0),
          -          end: Offset.zero,
          -        ).animate(curveAnimation);
          -        final fadeInAnimation = curveAnimation;
          -        return FadeTransition(
          -          opacity: fadeInAnimation,
          -          child: SlideTransition(position: offsetAnimation, child: child),
          +      transitionBuilder: (child, animation, secondaryAnimation) {
          +        return FadeThroughTransition(
          +          animation: animation,
          +          secondaryAnimation: secondaryAnimation,
          +          child: child,
                   );
                 },
                 duration: const Duration(milliseconds: 300),
      - name: Copy step_05_c
        copydir:
          from: quiz
          to: step_05_c

  - name: step_05_d
    steps:
      - name: Remove step_05_d
        rmdir: step_05_d
      - name: Patch lib/question_screen.dart
        path: quiz/lib/question_screen.dart
        patch-u: |
          --- b/animations/step_05_d/lib/question_screen.dart
          +++ a/animations/step_05_d/lib/question_screen.dart
          @@ -15,6 +15,7 @@ class _QuestionScreenState extends State<QuestionScreen> {
             late final QuizViewModel viewModel = QuizViewModel(
               onGameOver: _handleGameOver,
             );
          +  VoidCallback? _showGameOverScreen;
           
             @override
             Widget build(BuildContext context) {
          @@ -38,7 +39,11 @@ class _QuestionScreenState extends State<QuestionScreen> {
                     body: Center(
                       child: Column(
                         children: [
          -                QuestionCard(question: viewModel.currentQuestion?.question),
          +                QuestionCard(
          +                  onChangeOpenContainer: _handleChangeOpenContainer,
          +                  question: viewModel.currentQuestion?.question,
          +                  viewModel: viewModel,
          +                ),
                           Spacer(),
                           AnswerCards(
                             onTapped: (index) {
          @@ -59,24 +64,47 @@ class _QuestionScreenState extends State<QuestionScreen> {
               );
             }
           
          +  void _handleChangeOpenContainer(VoidCallback openContainer) {
          +    _showGameOverScreen = openContainer;
          +  }
          +
             void _handleGameOver() {
          -    showDialog(
          -      barrierDismissible: false,
          -      context: context,
          -      builder: (context) {
          -        return AlertDialog(
          -          title: Text('Game Over!'),
          -          content: Text('Score: ${viewModel.score}'),
          -          actions: [
          -            TextButton(
          +    if (_showGameOverScreen != null) {
          +      _showGameOverScreen!();
          +    }
          +  }
          +}
          +
          +class GameOverScreen extends StatelessWidget {
          +  final QuizViewModel viewModel;
          +  const GameOverScreen({required this.viewModel, super.key});
          +
          +  @override
          +  Widget build(BuildContext context) {
          +    return Scaffold(
          +      appBar: AppBar(automaticallyImplyLeading: false),
          +      body: Center(
          +        child: Column(
          +          mainAxisAlignment: MainAxisAlignment.center,
          +          children: [
          +            Scoreboard(
          +              score: viewModel.score,
          +              totalQuestions: viewModel.totalQuestions,
          +            ),
          +            Text('You Win!', style: Theme.of(context).textTheme.displayLarge),
          +            Text(
          +              'Score: ${viewModel.score} / ${viewModel.totalQuestions}',
          +              style: Theme.of(context).textTheme.displaySmall,
          +            ),
          +            ElevatedButton(
          +              child: Text('OK'),
                         onPressed: () {
                           Navigator.popUntil(context, (route) => route.isFirst);
                         },
          -              child: Text('OK'),
                       ),
                     ],
          -        );
          -      },
          +        ),
          +      ),
               );
             }
           }
          @@ -84,14 +112,22 @@ class _QuestionScreenState extends State<QuestionScreen> {
           class QuestionCard extends StatelessWidget {
             final String? question;
           
          -  const QuestionCard({required this.question, super.key});
          +  const QuestionCard({
          +    required this.onChangeOpenContainer,
          +    required this.question,
          +    required this.viewModel,
          +    super.key,
          +  });
          +
          +  final ValueChanged<VoidCallback> onChangeOpenContainer;
          +  final QuizViewModel viewModel;
          +
          +  static const _backgroundColor = Color(0xfff2f3fa);
           
             @override
             Widget build(BuildContext context) {
               return PageTransitionSwitcher(
          -      layoutBuilder: (entries) {
          -        return Stack(alignment: Alignment.topCenter, children: entries);
          -      },
          +      duration: const Duration(milliseconds: 200),
                 transitionBuilder: (child, animation, secondaryAnimation) {
                   return FadeThroughTransition(
                     animation: animation,
          @@ -99,17 +135,30 @@ class QuestionCard extends StatelessWidget {
                     child: child,
                   );
                 },
          -      duration: const Duration(milliseconds: 300),
          -      child: Card(
          +      child: OpenContainer(
                   key: ValueKey(question),
          -        elevation: 4,
          -        child: Padding(
          -          padding: const EdgeInsets.all(16.0),
          -          child: Text(
          -            question ?? '',
          -            style: Theme.of(context).textTheme.displaySmall,
          -          ),
          +        tappable: false,
          +        closedColor: _backgroundColor,
          +        closedShape: const RoundedRectangleBorder(
          +          borderRadius: BorderRadius.all(Radius.circular(12.0)),
                   ),
          +        closedElevation: 4,
          +        closedBuilder: (context, openContainer) {
          +          onChangeOpenContainer(openContainer);
          +          return ColoredBox(
          +            color: _backgroundColor,
          +            child: Padding(
          +              padding: const EdgeInsets.all(16.0),
          +              child: Text(
          +                question ?? '',
          +                style: Theme.of(context).textTheme.displaySmall,
          +              ),
          +            ),
          +          );
          +        },
          +        openBuilder: (context, closeContainer) {
          +          return GameOverScreen(viewModel: viewModel);
          +        },
                 ),
               );
             }
      - name: Copy step_05_d
        copydir:
          from: quiz
          to: step_05_d
      - name: dart analyze
        path: quiz
        dart: analyze --fatal-infos
      - name: Build Android app
        platforms: [ macos ]
        path: quiz
        flutter: build apk
      - name: Build iOS app
        platforms: [ macos ]
        path: quiz
        flutter: build ios --simulator
      - name: Build macOS app
        platforms: [ macos ]
        path: quiz
        flutter: build macos
      - name: Build Linux app
        platforms: [ linux ]
        path: quiz
        flutter: build linux
      - name: Build Windows app
        platforms: [ windows ]
        path: quiz
        flutter: build windows
      - name: Build Web app
        path: quiz
        flutter: build web

  - name: Cleanup
    rmdir: quiz